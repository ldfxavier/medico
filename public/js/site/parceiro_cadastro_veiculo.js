$(function(){var a=$("#LINK").val(),o=function(a,o){1==a.erro?(Loading.hide(),Alerta.mensagem(a.titulo,a.texto)):0==a.erro&&(Loading.hide(),$("#img").css({top:0,left:0}),$("#img").attr({src:a.link}),o.addClass("ativo"),$("input.input_imagem",o).val(a.arquivo)),$("input[type=file]",o).val("")};$("body").on("change","#upload",function(){let e=$(this).closest(".bloco_foto");var n=new FormData;n.append("foto",$(this).prop("files")[0]),Loading.show(),$.ajax({url:a+"/salvar-imagem",data:n,type:"post",dataType:"json",success:function(a){$("#img").css({top:0,left:0}),$("#img").draggable({containment:"parent",scroll:!1}),o(a,e)},error:function(a){o(a,e)},processData:!1,cache:!1,contentType:!1})}),$("#botao_enviar_cadastro").click(function(a){a.preventDefault();const o=$(this).closest("form");let e=$("input[name=marca]",o).val(),n=$("input[name=cor]",o).val(),t=$("input[name=valor]",o).val(),l=$("input[name=desconto]",o).val(),i=$("input[name=foto_upload]",o).val(),s={};$(".container_modelo .bloco",o).each(function(a){""!==$("input[name=marca_modelo]",this).val()&&""!==$("input[name=cor_modelo]",this).val()&&""!==$("input[name=valor_modelo]",this).val()&&""!==$("input[name=desconto_modelo]",this).val()&&(s[a]={marca:$("input[name=marca_modelo]",this).val()||"",cor:$("input[name=cor_modelo]",this).val()||"",valor:$("input[name=valor_modelo]",this).val()||"",desconto:$("input[name=desconto_modelo]",this).val()||""})}),$.post(o.attr("action"),{ajax:!0,marca:e,cor:n,valor:t,desconto:l,modelo:s,foto:i},a=>{Loading.hide(),0==a.erro?($("input[name=marca]",o).val(""),$("input[name=cor]",o).val(""),$("input[name=valor]",o).val(""),$("input[name=desconto]",o).val(""),$("input[name=foto]",o).val(""),$("input[name=uuid]",o).val(""),$("#img").attr({src:""}),$(".container_modelo .bloco",o).each(function(a){""!==$("input[name=marca_modelo]",this).val()&&""!==$("input[name=cor_modelo]",this).val()&&""!==$("input[name=valor_modelo]",this).val()&&""!==$("input[name=desconto_modelo]",this).val()&&(s[a]={marca:$("input[name=marca_modelo]",this).val(""),cor:$("input[name=cor_modelo]",this).val(""),valor:$("input[name=valor_modelo]",this).val(""),desconto:$("input[name=desconto_modelo]",this).val("")})}),Alerta.mensagem("Sucesso!","Veículo registrado com sucesso.")):1==a.erro&&Alerta.mensagem(a.titulo,a.texto)},"json").fail(a=>{Loading.hide(),1==(a=JSON.parse(a.responseText)).erro&&Alerta.mensagem(a.titulo,a.texto)}).always(function(){Loading.hide()})}),$("#botao_enviar_atualizacao").click(function(a){a.preventDefault();const o=$(this).closest("form");let e=$("input[name=marca]",o).val(),n=$("input[name=cor]",o).val(),t=$("input[name=valor]",o).val(),l=$("input[name=desconto]",o).val(),i=$("input[name=foto_upload]",o).val(),s=$("input[name=uuid]",o).val(),m={};$(".container_modelo .bloco",o).each(function(a){""!==$("input[name=marca_modelo]",this).val()&&""!==$("input[name=cor_modelo]",this).val()&&""!==$("input[name=valor_modelo]",this).val()&&""!==$("input[name=desconto_modelo]",this).val()&&(m[a]={id:$("input[name=id_modelo]",this).val()||"",marca:$("input[name=marca_modelo]",this).val()||"",cor:$("input[name=cor_modelo]",this).val()||"",valor:$("input[name=valor_modelo]",this).val()||"",desconto:$("input[name=desconto_modelo]",this).val()||""})}),$.post(o.attr("action"),{ajax:!0,marca:e,cor:n,valor:t,desconto:l,modelo:m,foto:i,uuid:s},a=>{Loading.hide(),0==a.erro?Alerta.mensagem("Sucesso!","Veículo atualizado com sucesso."):1==a.erro&&Alerta.mensagem(a.titulo,a.texto)},"json").fail(a=>{Loading.hide(),1==(a=JSON.parse(a.responseText)).erro&&Alerta.mensagem(a.titulo,a.texto)}).always(function(){Loading.hide()})});var e=0;$("body").on("click",".adiciona_modelo",function(a){a.preventDefault();let o=++e+1;$(".container_modelo").append('\n            <article class="bloco">\n                    <header class="bloco__titulo">\n                        <h1>Modelo '+o+' </h1>\n                    </header>\n\n                    <input type="hidden" name="id_modelo" value="">\n                    <div class="bloco__label modelo">\n                            <input name="marca_modelo" type="text" placeholder=" ">\n                            <span class="linha"></span>\n                            <label>MARCA</label>\n                        </div>\n                        <div class="bloco__label">\n                            <input name="cor_modelo" type="text" placeholder=" ">\n                            <span class="linha"></span>\n                            <label>COR</label>\n                        </div>\n                        <div class="bloco__label">\n                            <input data-mascara="dinheiro" name="valor_modelo" type="text" placeholder=" ">\n                            <span class="linha"></span>\n                            <label>VALOR</label>\n                        </div>\n                        <div class="bloco__label">\n                            <input name="desconto_modelo" type="text" placeholder=" ">\n                            <span class="linha"></span>\n                            <label>DESCONTO</label>\n                        </div>\n                </article>\n            </div>\n        ')})});